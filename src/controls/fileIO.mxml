<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx">
	
	<fx:Script>
		<![CDATA[		
			/** * Hard-code the URL of file to download to user's computer. */	
			
			import mx.controls.Alert;
			//private const DOWNLOAD_URL:String = "192.168.44.200";			
			/** * Create a FileReference instance to handle the file download. */
			private var fr:FileReference;			
			/** * Define reference to the download ProgressBar component. */
			private var pb:ProgressBar;			
			/** * Define reference to the "Cancel" button which will immediately stop
			 * the current download in progress. */
			private var btn:Button;
			//private var address:String = "192.168.44.200";
			private var address:String = "213.197.173.50";
			
			public function init():void
			{
				// Set up the references to the progress bar and cancel button,
				// which are passed from the calling script.
				this.pb  = this.downloadProgress;
				this.btn = this.cancelDownloadBtn;
				
				fr = new FileReference();
				fr.addEventListener(Event.OPEN, openHandler);
				fr.addEventListener(ProgressEvent.PROGRESS, progressHandler);
				fr.addEventListener(Event.COMPLETE, completeHandler);
			}
			
			/** * Begin downloading the file specified in the DOWNLOAD_URL constant.*/
			public function startDownload():void
			{
				var request:URLRequest = new URLRequest();				
				var fullSmry:String = "EMI-Duracell DBCM Full Report_CN, IN, BR, TR.pdf";
				var u:String = "http://" + address
							   + "/Consulting/Duracell/testData/"
							   + fullSmry;	

				request.url = u;
				fr.download(request);
			}
			
			/*** When the OPEN event has dispatched, change the progress bar's label 
			 * and enable the "Cancel" button, which allows the user to abort the 
			 * download operation.*/
			private function openHandler(event:Event):void
			{
				pb.label = "DOWNLOADING %3%%";
				btn.enabled = true;
			}
			
			/*** While the file is downloading, update the progress bar's status. */
			private function progressHandler(event:ProgressEvent):void
			{
				pb.setProgress(event.bytesLoaded, event.bytesTotal);
			}
			
			/*** Once the download has completed, change the progress bar's label one 
			 * last time and disable the "Cancel" button since the download is 
			 * already completed.	 */
			private function completeHandler(event:Event):void
			{
				pb.label = "DOWNLOAD COMPLETE";
				btn.enabled = false;				
				Alert.show("Download Complete", "Info");
				this.dispatchEvent(new Event("downloadFinished", true));				
			}
			
			/*** Cancel the current file download. */
			public function cancelDownload():void
			{
				fr.cancel();
				pb.label = "DOWNLOAD CANCELLED";
				btn.enabled = false;
				this.dispatchEvent(new Event("downloadFinished", true));
			}
		]]>
	</fx:Script>
	
	<mx:Panel title="Download File" paddingTop="10" paddingBottom="10" paddingLeft="10" paddingRight="10">
		<mx:ProgressBar id="downloadProgress" label="" mode="manual" />
		<mx:ControlBar horizontalAlign="right">
			<mx:Button id="startDownloadBtn"  label="Download..." click="startDownload();"  />
			<mx:Button id="cancelDownloadBtn" label="Cancel" click="cancelDownload();" 
					   enabled="true" />
		</mx:ControlBar>
	</mx:Panel>

	
</s:Group>
